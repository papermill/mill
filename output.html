<!DOCTYPE html>

<html>
<head>
  <title>output.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="alias.html">
                alias.js
              </a>
            
              
              <a class="source" href="mill-build.html">
                mill-build.js
              </a>
            
              
              <a class="source" href="output.html">
                output.js
              </a>
            
              
              <a class="source" href="readProjectConfig.html">
                readProjectConfig.js
              </a>
            
              
              <a class="source" href="utils.html">
                utils.js
              </a>
            
              
              <a class="source" href="mill-cli.html">
                mill-cli.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>output.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="comment">/*jslint node: true, regexp: true, nomen: true, sloppy: true, vars: true, white: true */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap for-h1">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h1>mill <strong>output</strong></h1>
<blockquote>
<p>Create and set up a new project.</p>
</blockquote>
<hr>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>(Required modules)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">var</span> fs = require(<span class="string">'graceful-fs'</span>),
    path = require(<span class="string">'path'</span>),
    async = require(<span class="string">'async'</span>),
    f = require(<span class="string">'underscore'</span>),
    build = require(<span class="string">'../build/mill-build'</span>),
    readProjectConfig = require(<span class="string">'../readProjectConfig'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h2>Usage Information</h2>
<p>This is displayed when the user requests help on this command.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">var</span> usage= [
  <span class="string">'Renders a papermill project according to settings.'</span>,
  <span class="string">'- Can export to PDF (print) and HTML (web)'</span>,
  <span class="string">'- Uses auto-mode when no settings are found'</span>,
  <span class="string">''</span>,
  <span class="string">'Usage: mill output &lt;project&gt; [--format]'</span>,
  <span class="string">''</span>,
  <span class="string">'Example usages:'</span>,
  <span class="string">'mill print'</span>,
  <span class="string">'mill output --print &lt;/path/to/project&gt;'</span>,
  <span class="string">'mill web'</span>,
  <span class="string">'mill output --web .'</span> 
];</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <h2>Workflow: <strong>output</strong></h2>
<p>this function gets called by the cli app when the user runs the <strong>output</strong> command.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="keyword">function</span> <span class="title">output</span> <span class="params">(dir, callback)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Our context is set to the application, we save it in a variable for convenience.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> app = <span class="keyword">this</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>TODO: loop over all args</p>

            </div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>TODO: see if arg is file or path</p>

            </div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>set path from supplied argument or use the current working directory</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  dir = dir || <span class="string">'.'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>make the path absolute from the current working directory</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  dir = path.resolve(process.cwd(), dir);
  
  <span class="keyword">if</span> (mill.DEBUG) { app.log.debug(<span class="string">"dir: "</span>, dir); }</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>For control flow, we use an <code>async</code> chain of events, where <a href="https://github.com/caolan/async#waterfall">&quot;each functions callback value becomes the next functions first argument&quot;</a>:</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  async.waterfall([</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <ol>
<li>Get the user configuration</li>
</ol>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="function"><span class="keyword">function</span> <span class="title">getUserConf</span><span class="params">(callback)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <ul>
<li>try to read config file from project path</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>        readProjectConfig(dir, app.config.get(), callback);  
      
      },</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <ol>
<li>Build with the configuration</li>
</ol>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="function"><span class="keyword">function</span> <span class="params">(config, callback)</span> {</span>
        build(config, callback);
      }
    ],</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <ol>
<li>Done</li>
</ol>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="function"><span class="keyword">function</span> <span class="title">finishedChain</span><span class="params">(err, result)</span> {</span>
      
      <span class="keyword">if</span> (err) { <span class="keyword">return</span> app.fail(err, callback); }</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <ul>
<li>build answer</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">var</span> res = result;</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <ul>
<li>callback to the CLI</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> (mill.DEBUG) { app.log.debug(<span class="string">"build res: "</span>, res); }
      callback(<span class="literal">null</span>, res);
    
  });
  
}</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>The whole command workflow lies in 1 main function,
which we also export as a module;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>output.usage = usage;
module.exports = output;</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
